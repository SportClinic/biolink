<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ุญุฌุฒ ููุนุฏ</title>
 <style>
 body {
 text-align: end;
 font-family: Arial, sans-serif;
 background-color: #f9f9f9;
color: #333;
 direction: rtl;
 }
 header {
 background: #4CAF50;
 color: white;
 padding: 1rem 0;
 text-align: center;
}
 .container {
padding: 20px;
 max-width: 500px;
 margin: auto;
 }
 label, input, select, textarea, button {
 display: block;
 width: 100%;
 margin-bottom: 10px;
 padding: 10px;
 border-radius: 4px;
 border: 1px solid #ccc;
 box-sizing: border-box; /* ุชูุช ุฅุถุงูุชู ูุถูุงู ุนุฑุถ 100% ุตุญูุญ ูููุฏุฎูุงุช */
 }
button {
 background-color: #4CAF50;
 color: white;
 border: none;
 cursor: pointer;
 }
 button:hover {
 background-color: #45a049;
 }
 #result {
 text-align: center;
 color: green;
 margin-top: 10px;
 }
 </style>
</head>
<body>

 <header>
 <h1>ูููุฐุฌ ุงูุญุฌุฒ</h1>
 </header>

 <div class="container">
 <form id="bookingForm">
 <label>ุงูุงุณู ุงููุงูู</label>
 <input type="text" id="name" required>

 <label>ุงูุญุงูุฉ ุงูุตุญูุฉ</label>
 <input type="text" id="status" required>

 <label>ุฑูู ุงููุงุชุณุงุจ</label>
 <input type="text" id="whatsapp" required>

<label>ุชุงุฑูุฎ ุงูููุนุฏ</label>
<input type="date" id="date" required>

 <label>ุงูุณุงุนุฉ</label>
<select id="time" required>
 <option value="">-- ุงุฎุชุฑ ุงูุณุงุนุฉ --</option>
</select>
 <label>ููุงุญุธุงุช ุฅุถุงููุฉ</label>
 <textarea id="notes" rows="4"></textarea>

 <button type="submit">ุงุญุฌุฒ ุงูุขู</button>
 </form>

 <p id="result"></p>
 </div>

 <script>
        // โ [ุชู ุชุนุฏูู ุงูุฑุงุจุท] โ
        // ูุงู ุงูุฎูู ุจุณุจุจ ูุณุงุฑ ุงูููู ุงููุญูู ุงููุถุงู ููุฑุงุจุท.
        // ุงูุฑุฌุงุก ุงุณุชุจุฏุงู 'UNIQUE_ID_HERE_FROM_N8N' ุจุงููุนุฑู ุงููุฑูุฏ ุงูุฐู ุชุญุตู ุนููู ูู ุนูุฏุฉ Webhook ูู N8N.
        const N8N_WEBHOOK_URL = 'https://n8n.srv1070817.hstgr.cloud/webhook/91121f62-a9f4-4446-856e-f3da048d718e'; 
        const CURRENT_PAGE_URL = window.location.href; 
        const MAX_RETRIES = 3;
        const initialDelay = 1000;

 const timeSelect = document.getElementById("time");
        // ุชููุฆุฉ ุงูุณุงุนุงุช
 for (let i = 8; i <= 21; i++) { 
 let hour = i.toString().padStart(2, '0');
 // ุชู ุงูุงูุชุฒุงู ุจููุท ุนุฑุถ ุงูููุช ุงูุฃุตูู ุงูุฐู ุฃุฑุณูุชู
 let label = (i < 12) ? `${i} ุตุจุงุญูุง` : ((i === 12) ? `12 ุธูุฑูุง` : `${i - 12} ูุณุงุกู`);
 let option = document.createElement("option");
 option.value = `${hour}:00`;
 option.textContent = label;
 timeSelect.appendChild(option);
 }

        // ุฏุงูุฉ ุฅุฑุณุงู ุงููููุฐุฌ ุฅูู N8N Webhook
 document.getElementById("bookingForm").addEventListener("submit", async function(e) {
e.preventDefault();
            const form = e.target;
const statusElement = document.getElementById("result"); 
            // ุฅุนุงุฏุฉ ุชุนููู ุงูููู ููุจุฏุก (ุงูููู ุงูุฃุฎุถุฑ ูู ุงูุงูุชุฑุงุถู ูู CSS)
            statusElement.style.color = 'green'; 
            statusElement.textContent = ''; 
            
 const data = {
 name: form.querySelector("#name").value,
 status: form.querySelector("#status").value,
 whatsapp: form.querySelector("#whatsapp").value,
date: form.querySelector("#date").value,
time: form.querySelector("#time").value,
 notes: form.querySelector("#notes").value,
            webPageUrl: CURRENT_PAGE_URL 
 };

            // ุฑุณุงูุฉ ุงูุจุฏุงูุฉ (ููู ุฃุฒุฑู ููุชุญููู - ุจุงุณุชุฎุฏุงู inline style ูุชุฌูุจ ุชุบููุฑ CSS)
            statusElement.textContent = 'ุฌุงุฑู ุฅุฑุณุงู ุทูุจ ุงูุญุฌุฒ... ูุฑุฌู ุงูุงูุชุธุงุฑ.';
            statusElement.style.color = 'blue';

            // ููุทู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุน ุงูุชุฑุงุฌุน ุงูุฃุณู (Exponential Backoff)
            for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
                try {
                    const response = await fetch(N8N_WEBHOOK_URL, {
                        method: 'POST',
                        // ุฅุฑุณุงู ุงูุจูุงูุงุช ุจุตูุบุฉ JSON (ููุงุณู ูู N8N)
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        statusElement.textContent = "โ ุชู ุฅุฑุณุงู ุงูุญุฌุฒ ุจูุฌุงุญ!";
                        statusElement.style.color = 'green'; // ููู ุงููุฌุงุญ ูู ุชุตูููู ุงูุฃุตูู
                        form.reset();
                        return;
                    } else if (response.status === 429 && attempt < MAX_RETRIES - 1) {
                        const delay = initialDelay * Math.pow(2, attempt);
                        statusElement.textContent = `๐ซ ุชุฌุงูุฒ ุญุฏ ุงูุฅุฑุณุงู. ูุญุงููุฉ ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุจุนุฏ ${delay / 1000} ุซูุงูู...`;
                        statusElement.style.color = 'orange'; 
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        statusElement.textContent = `โ ุญุฏุซ ุฎุทุฃ ูู ุงููุธุงู. ุฑูุฒ ุงูุฎุทุฃ: ${response.status}. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.`;
                        statusElement.style.color = 'red'; 
                        return;
                    }
                } catch (error) {
                    console.error('Fetch Error:', error);
                    statusElement.textContent = 'โ ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ูุฑุฌู ุงูุชุญูู ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช.';
                    statusElement.style.color = 'red'; 
                    return;
                }
            }
            
            // ูู ุญุงูุฉ ูุดู ุฌููุน ุงููุญุงููุงุช
            statusElement.textContent = 'โ ูุดูุช ูุญุงููุงุช ุฅุฑุณุงู ุงูุทูุจ ุจุนุฏ ูุญุงููุงุช ุนุฏูุฏุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.';
            statusElement.style.color = 'red';
});
 </script>

</body>

</html>


